<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>scroll.me</title> 
  <meta name="author" content="Jordan Cazamias | https://github.com/jaycaz">
  <link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
  <div id="toolbar">
    <div id="npage-label"></div>
    <p>Num Pages</p>
    <div id="npage-slider" class="ui-slider">
      <div id="npage-handle" class="ui-slider-handle"></div>
    </div>
    <p>Current Page</p>
    <div id="currpage-slider" class="ui-slider">
      <div id="currpage-handle" class="ui-slider-handle"></div>
    </div>
  </div>
  <div id="viz">
<!--     <svg>
      <div class="section group">
      <div id="panel-left" class="col span_1_of_3">
      This is column 1
      </div>
      <div id="panel-center" class="col span_1_of_3">
      This is column 2
      </div>
      <div id="panel-right" class="col span_1_of_3">
      This is column 3
      </div>
    </svg>
 -->
  </div>
</body>


<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>

var pages = [];
var npages = 0;
var currPage = 0;

// Global variables for page dimensions
// I know this is probably not the JS way to do it, sue me
var PAGE_WIDTH = 25;
var PAGE_HEIGHT = 37;
var PAGE_SHIFT_X = 30;
var PAGE_SHIFT_Y = 50;
var PAGES_PER_COL = 30;
var FULL_PAGE_WIDTH = 820;
var FULL_PAGE_HEIGHT = 1060;

$(function() {
  var handle = $("#npage-handle");
  $("#npage-slider").slider({
    min: 1,
    max: 1000,
    create: function() {
      handle.text($(this).slider("value"));
      setNpages($(this).slider("value"));
      update();
    },
    slide: function(event, ui) {
      handle.text(ui.value);
      setNpages(ui.value);
      // $('#currpage-slider').max = npages;
      update();
    }
  });
});

$(function() {
  var handle = $("#currpage-handle");
  $("#currpage-slider").slider({
    min: 1,
    max: 1000,
    create: function() {
      handle.text($(this).slider("value"));
      currPage = $(this).slider("value");
      update();
    },
    slide: function(event, ui) {
      handle.text(ui.value);
      currPage = ui.value;
      update();
    }
  });
});

var svg = d3.select("#viz")
  .append("svg")
  .attr("width", "100%")
  .attr("height", "100%")
  .style("padding", "10px");

function setNpages(n)
{
  // Depending on new value of npages, push/pop new pages to end
  if(n > npages)
  {
    for(var i = 0; i < (n-npages); i++)
    {
      pages.push({})
    }
  }
  else if(n < npages)
  {
    for(var i = 0; i < (npages-n); i++)
    {
      pages.pop();
    }
  }
  npages = n;
}

// Get position and dimensions of pages.
// depends on which page is currently open
function getPageX(d,i)
{
  x = parseInt(i / PAGES_PER_COL) * PAGE_SHIFT_X;
  if(i+1 < currPage)
    return x;
  else if (i+1 == currPage)
    return x + 2 * PAGE_SHIFT_X;
  else
    return x + 3 * PAGE_SHIFT_X + FULL_PAGE_WIDTH;
}

function getPageY(d,i)
{
  if(i+1 == currPage)
    return 0;
  else
    return parseInt(i % PAGES_PER_COL) * PAGE_SHIFT_Y;
}

function getPageW(d,i)
{
  if(i+1 == currPage)
    return FULL_PAGE_WIDTH;
  else
    return PAGE_WIDTH;
}

function getPageH(d,i)
{
  if(i+1 == currPage)
    return FULL_PAGE_HEIGHT;
  else
    return PAGE_HEIGHT;
}

function update() {

  var selection = svg.selectAll('rect')
    .data(pages);

  selection.enter()
    .append('rect');

  selection
    .attr('x', getPageX)
    .attr('y', getPageY)
    .attr('width', getPageW)
    .attr('height', getPageH)
    .attr('rx', 2)
    .attr('ry', 2)
    .style('stroke', '#000')
    .style('fill', '#e2e3e3');

  selection.exit().remove();
}
var bb = svg.node().getBBox();

</script>
</body>
</html>